{% extends "base.html" %}

{% block title %}Mi Perfil - Wine Shop{% endblock %}

{% block content %}
<style>
    .perfil-container {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 2rem;
        margin: 2rem 0;
    }

    .perfil-sidebar {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        height: fit-content;
    }

    .perfil-info-card {
        text-align: center;
        margin-bottom: 2rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid #eee;
    }

    .perfil-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(135deg, #722f37 0%, #8b4153 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2.5rem;
        margin: 0 auto 1rem;
    }

    .perfil-nombre {
        font-size: 1.3rem;
        color: #722f37;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .perfil-tipo {
        color: #999;
        font-size: 0.9rem;
    }

    .perfil-menu {
        list-style: none;
    }

    .perfil-menu li {
        margin-bottom: 0.5rem;
    }

    .perfil-menu a {
        display: block;
        padding: 0.75rem 1rem;
        color: #722f37;
        text-decoration: none;
        border-radius: 5px;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
    }

    .perfil-menu a:hover, .perfil-menu a.activo {
        background: #f5f1ed;
        border-left-color: #722f37;
        padding-left: 1.5rem;
    }

    .perfil-contenido {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .contenido-seccion {
        display: none;
    }

    .contenido-seccion.activo {
        display: block;
    }

    .seccion-titulo {
        font-size: 1.5rem;
        color: #722f37;
        margin-bottom: 1.5rem;
        border-bottom: 2px solid #d4a574;
        padding-bottom: 1rem;
    }

    .datos-personales {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .dato {
        background: #f9f9f9;
        padding: 1rem;
        border-radius: 5px;
    }

    .dato-label {
        color: #722f37;
        font-weight: 600;
        font-size: 0.85rem;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
    }

    .dato-valor {
        color: #666;
        font-size: 0.95rem;
    }

    .recompensas-box {
        background: linear-gradient(135deg, #722f37 0%, #8b4153 100%);
        color: white;
        padding: 2rem;
        border-radius: 10px;
        text-align: center;
        margin-bottom: 2rem;
    }

    .recompensas-numero {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .recompensas-texto {
        font-size: 1rem;
        opacity: 0.9;
    }

    .notificaciones-lista {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .notificacion-item {
        background: #f9f9f9;
        padding: 1rem;
        border-radius: 5px;
        border-left: 4px solid #d4a574;
    }

    .notificacion-titulo {
        color: #722f37;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .notificacion-mensaje {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }

    .notificacion-fecha {
        color: #999;
        font-size: 0.8rem;
    }

    .pedidos-tabla {
        width: 100%;
        border-collapse: collapse;
    }

    .pedidos-tabla thead {
        background: #f9f9f9;
    }

    .pedidos-tabla th, .pedidos-tabla td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid #eee;
    }

    .pedidos-tabla th {
        color: #722f37;
        font-weight: 600;
    }

    .estado-badge {
        display: inline-block;
        padding: 0.35rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .estado-pendiente {
        background: #fff3cd;
        color: #856404;
    }

    .estado-confirmado {
        background: #d1ecf1;
        color: #0c5460;
    }

    .estado-enviado {
        background: #cce5ff;
        color: #004085;
    }

    .estado-entregado {
        background: #d4edda;
        color: #155724;
    }

    .btn-editar {
        background: #722f37;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-editar:hover {
        background: #8b4153;
    }

    @media (max-width: 1024px) {
        .perfil-container {
            grid-template-columns: 1fr;
        }

        .perfil-sidebar {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            height: auto;
        }
    }

    @media (max-width: 768px) {
        .datos-personales {
            grid-template-columns: 1fr;
        }

        .perfil-sidebar {
            grid-template-columns: 1fr;
        }

        .perfil-contenido {
            padding: 1rem;
        }
    }
</style>

<div class="container">
    <h1 class="section-title">Mi Perfil</h1>

    <div class="perfil-container">
        <div class="perfil-sidebar">
            <div class="perfil-info-card">
                <div class="perfil-avatar"></div>
                <div class="perfil-nombre">{{ perfil.nombre_completo }}</div>
                <div class="perfil-tipo">{% if user.is_superuser %}Administrador{% else %}{{ perfil.get_tipo_usuario_display }}{% endif %}</div>
            </div>

            <ul class="perfil-menu">
                <li><a href="#" class="menu-link activo" onclick="mostrarSeccion('datos', event)">Mis Datos</a></li>
                <li><a href="#" class="menu-link" onclick="mostrarSeccion('recompensas', event)">Recompensas</a></li>
                <li><a href="#" class="menu-link" onclick="mostrarSeccion('pedidos', event)">Mis Pedidos</a></li>
                <li><a href="#" class="menu-link" onclick="mostrarSeccion('notificaciones', event)">Notificaciones</a></li>
                <li><a href="{% url 'logout' %}">Cerrar Sesi贸n</a></li>
            </ul>
        </div>

        <div class="perfil-contenido">
            <!-- Secci贸n Datos Personales -->
            <div id="datos" class="contenido-seccion activo">
                <h2 class="seccion-titulo">Mis Datos Personales</h2>

                <div class="datos-personales">
                    <div class="dato">
                        <div class="dato-label">Nombre Completo</div>
                        <div class="dato-valor">{{ perfil.nombre_completo }}</div>
                    </div>
                    <div class="dato">
                        <div class="dato-label">Email</div>
                        <div class="dato-valor">{{ user.email }}</div>
                    </div>
                    <div class="dato">
                        <div class="dato-label">Tel茅fono</div>
                        <div class="dato-valor">{{ perfil.telefono|default:"No registrado" }}</div>
                    </div>
                    <div class="dato">
                        <div class="dato-label">Ciudad</div>
                        <div class="dato-valor">{{ perfil.ciudad|default:"No registrada" }}</div>
                    </div>
                </div>

                {% if perfil.direccion %}
                <div class="dato" style="grid-column: 1/-1;">
                    <div class="dato-label">Direcci贸n</div>
                    <div class="dato-valor">{{ perfil.direccion }}</div>
                </div>
                {% endif %}

                <button class="btn btn-editar" onclick="editarPerfil()">Editar Perfil</button>
            </div>

            <!-- Secci贸n Recompensas -->
            <div id="recompensas" class="contenido-seccion">
                <h2 class="seccion-titulo">Mis Recompensas</h2>

                <div class="recompensas-box">
                    <div class="recompensas-numero">{{ perfil.puntos_recompensa }}</div>
                    <div class="recompensas-texto">Puntos Acumulados</div>
                </div>

                <p style="color: #666; margin-bottom: 1.5rem;">
                    Ganas 1 punto por cada 10 USD gastados. Puedes canjear tus puntos por descuentos en futuras compras.
                </p>

                <h3 style="color: #722f37; margin-bottom: 1rem; font-weight: 600;">Historial de Recompensas</h3>
                {% if recompensas %}
                <div style="overflow-x: auto;">
                    <table class="pedidos-tabla">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Motivo</th>
                                <th>Tipo</th>
                                <th>Puntos</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for recompensa in recompensas %}
                            <tr>
                                <td>{{ recompensa.fecha|date:"d/m/Y" }}</td>
                                <td>{{ recompensa.motivo }}</td>
                                <td>
                                    <span class="estado-badge {% if recompensa.tipo == 'ganado' %}estado-entregado{% else %}estado-pendiente{% endif %}">
                                        {{ recompensa.get_tipo_display }}
                                    </span>
                                </td>
                                <td>{% if recompensa.tipo == 'ganado' %}+{% else %}-{% endif %}{{ recompensa.puntos }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p style="color: #999; text-align: center; padding: 2rem;">A煤n no tienes recompensas</p>
                {% endif %}
            </div>

            <!-- Secci贸n Pedidos -->
            <div id="pedidos" class="contenido-seccion">
                <h2 class="seccion-titulo">Mis Pedidos</h2>
                <a href="{% url 'mis_pedidos' %}" class="btn btn-primary" style="margin-bottom: 1.5rem;">Ver Todos los Pedidos</a>
            </div>

            <!-- Secci贸n Notificaciones -->
            <div id="notificaciones" class="contenido-seccion">
                <h2 class="seccion-titulo">Mis Notificaciones</h2>

                {% if notificaciones %}
                <div class="notificaciones-lista">
                    {% for notificacion in notificaciones %}
                    <div class="notificacion-item">
                        <div class="notificacion-titulo">{{ notificacion.titulo }}</div>
                        <div class="notificacion-mensaje">{{ notificacion.mensaje }}</div>
                        <div class="notificacion-fecha">{{ notificacion.fecha|date:"d/m/Y H:i" }}</div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p style="color: #999; text-align: center; padding: 2rem;">No tienes notificaciones</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
    function mostrarSeccion(seccion, event) {
        event.preventDefault();

        // Ocultar todas las secciones
        document.querySelectorAll('.contenido-seccion').forEach(el => {
            el.classList.remove('activo');
        });

        // Desactivar todos los enlaces del men煤
        document.querySelectorAll('.menu-link').forEach(el => {
            el.classList.remove('activo');
        });

        // Mostrar la secci贸n seleccionada
        document.getElementById(seccion).classList.add('activo');
        event.target.classList.add('activo');
    }

    function editarPerfil() {
        alert('Funcionalidad de edici贸n disponible pr贸ximamente');
    }
</script>
{% endblock %}
